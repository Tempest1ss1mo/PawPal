FROM python:3.11-slim

WORKDIR /app

# Copy composite service requirements and install
COPY composite-service/requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Copy models directory (needed by composite service)
COPY models ./models

# Copy composite service code
COPY composite-service/*.py ./
COPY composite-service/__init__.py ./

# Set environment variables
ENV PORT=8080

CMD exec uvicorn main:app --host 0.0.0.0 --port $PORT
